<!DOCTYPE html>
<html lang="ru" xml:lang="ru" xmlns="http://www.w3.org/1999/xhtml">

<head>

	<link rel="icon" type="image/x-icon" href="/favicon.ico" />

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1" />

	<style media="all">

		@page {
			size: 450mm 320mm;
			margin: 0;
		}

		@font-face {
			font-family: 'Open Sans Condensed';
			src: local( 'Open Sans Condensed Bold' ),
				 url( '/@/OpenSansCondensed-Bold.ttf' );
		}

		@font-face {
			font-family: 'Open Sans Condensed Light';
			src: local( 'Open Sans Condensed Light' ),
				 url( '/@/OpenSansCondensed-Light.ttf' );
		}

		*,
		:after,
		:before {
			margin: 0;
			padding: 0;
			border: 0;
			transition: all 0.1s linear;
		}

		ul {
			list-style-type: none;
		}

		body {
			font-family: 'Open Sans Condensed Light', Arial, sans-serif;
			width: 450mm;
			height: 640mm;
			background: #fff;
		}

		[contenteditable="true"] {
			-webkit-user-modify: read-only;
		}

		.page {

			--ratio: 1;

			width: calc( 450mm - 16mm );
			height: calc( 320mm - 16mm );
			padding: 8mm;
			display: grid;
			grid-template-columns: 96.5mm 96.5mm 96.5mm 96.5mm;
			grid-gap: 16mm;

			overflow: hidden;

		}

		.mini {
			display: grid;
			grid-template-columns: 46.25mm 46.25mm;
			grid-gap: 4mm;
		}

		.bold {
			font-family: 'Open Sans Condensed', Arial, sans-serif;
			text-transform: uppercase;
		}

		.brackets:not( :empty ):before {
			content: '(';
		}

		.brackets:not( :empty ):after {
			content: ')';
		}

		.ml:not( :empty ):after {
			content: 'ml';
		}

		.L:not( :empty ):after {
			content: 'L';
		}

		.percent:not( :empty ):after {
			content: '%';
		}

		.nowrap {
			white-space: nowrap;
		}

		.opacity {
			opacity: 0.6;
		}

		.opacity .opacity {
			opacity: 1;
		}

		.sub-title,
		.title {
			font-size: calc( 23pt * var( --ratio ) );
			line-height: calc( 23pt * var( --ratio ) );
		}

		.sub-title {
			font-size: calc( 13pt * var( --ratio ) );
		}

		.sub-text {
			font-size: calc( 12pt * var( --ratio ) );
		}

		.nbsp:after {
			content: '  ';
		}

		.slash > span:not( :empty ) + :before {
			content: ' / ';
		}

		.empty {
			display: none !important;
		}

		.section {

			display: grid;
			grid-template-columns: auto min-content;
			grid-gap: calc( 4pt * var( --ratio ) * var( --ratio ) ) 4pt;

			font-size: calc( 13.2pt * var( --ratio ) );

			margin-bottom: calc( 14pt * var( --ratio ) * var( --ratio ) * var( --ratio ) * var( --ratio ) );

		}

		.section > .sub-title {
			text-align: right;
		}

		.section > ul {
			grid-column-start: 1;
			grid-column-end: 3;
		}

		.item {
			display: grid;
			grid-template-columns: auto min-content;
			grid-gap: 0 2mm;
		}

		.item > ul {
			margin-left: 6mm;
			grid-column-start: 1;
			grid-column-end: 3;
		}

		.item > div {
			display: inline-block;
			line-height: calc( 16pt * var( --ratio ) * var( --ratio ) );
		}

		.item > div:not( :nth-child( 1 ) ) {
			text-align: right;
		}

		.item.ext {
			grid-template-columns: auto min-content 11mm;
		}

		.shot .name {
			font-size: calc( 16pt * var( --ratio ) );
		}

		.cost > span + span {
			font-size: calc( 11pt * var( --ratio ) );
		}

		.cost > span + span:not( :empty ):before {
			content: '.';
		}

		.img {
			width: 96.5mm;
			text-align: center;
			position: absolute;
			bottom: 12mm;
		}

		@media screen {

			html {
				background: #999;
			}

			.page {
				outline: 1px solid #555;
				position: relative;
			}

			.page:before {
				content: '';
				display: block;
				position: absolute;
				top: 8mm;
				right: 8mm;
				bottom: 8mm;
				left: 8mm;
				outline: 1mm dashed #f99;
				pointer-events: none;
			}

		}

	</style>

	<template id="section">
		<div class="section">
			<div class="title bold" contenteditable="true"></div>
			<div class="sub-title opacity"></div>
			<ul></ul>
		</div>
	</template>

	<template id="weight">
		<span class="weight opacity brackets sub-text" contenteditable="true"></span>
	</template>

	<template id="slash">
		<span class="nowrap slash"></span>
	</template>

	<template id="bold-slash">
		<span class="bold nowrap slash"></span>
	</template>

	<template id="cost">
		<span class="cost bold"><span contenteditable="true"></span><span contenteditable="true"></span></span>
	</template>

	<template id="ml">
		<span class="ml" contenteditable="true"></span>
	</template>

	<template id="dish">
		<li class="dish item">
			<div><span class="nbsp" contenteditable="true"></span></div>
			<div></div>
			<ul></ul>
		</li>
	</template>

	<template id="alc">
		<li class="dish item">
			<div><span class="name" contenteditable="true"></span> <span class="kind opacity" contenteditable="true"></span></div>
			<div></div>
		</li>
	</template>

	<template id="beer">
		<li class="beer item ext">
			<div>
				<span class="name" contenteditable="true"></span>
			</div>
			<div class="opacity nowrap sub-text slash">
				<span class="alc percent" contenteditable="true"></span>
				<span class="den percent" contenteditable="true"></span>
				<span class="cap L" contenteditable="true"></span>
			</div>
			<div></div>
		</li>
	</template>

	<template id="cocktail">
		<li class="cocktail item ext">
			<div>
				<span class="name" contenteditable="true"></span>
			</div>
			<div class="opacity sub-text">
				<span class="cap ml" contenteditable="true"></span>
			</div>
			<div></div>
		</li>
	</template>

	<template id="shot">
		<div class="shot item ext">
			<div class="bold">
				<span class="name" contenteditable="true"></span>
			</div>
			<div class="opacity sub-text">
				<span class="cap ml" contenteditable="true"></span>
			</div>
			<div></div>
		</div>
	</template>

</head>

<body>

<article class="page">
	<div style="--ratio:0.995"></div>
	<div style="--ratio:0.99"></div>
	<div></div>
	<div></div>
</article>

<article class="page">
	<div style="--ratio:1"></div>
	<div style="--ratio:0.858"></div>
	<div style="text-align:center"></div>
	<div></div>
</article>

<script type="text/javascript">( ( /** Window */ window ) =>  window.fetch( 'data.js?' + window.Math.random() ).then( ( respose ) => respose.text() ).then( ( data ) => {

	data = window.eval( data );

	/** @noinline */
	var querySelector = ( node, selector ) => node.querySelector( selector );
	/** @noinline */
	var querySelectorAll = ( node, selector ) => node.querySelectorAll( selector );
	/** @noinline */
	var cloneNode = ( node ) => document.importNode( node.content, true );
	/** @noinline */
	var appendChild = ( node, child ) => node.appendChild( child );

	var document =	window.document;
	var Array =		window.Array;

	var lang = window.location.search.replace( /^\?/, '' ) === 'en' ? 1 : 0;

	var getName = ( data ) => Array.isArray( data ) ? data[ lang ] : data;

	var sectionTemplate = querySelector( document, '#section' );

	var createSection = ( data, createLI, createSUB = null ) => {

		var result = cloneNode( sectionTemplate );

		var left = querySelector( result, '.title' );
		var right = querySelector( result, '.sub-title' );
		var bottom = querySelector( result, 'ul' );

		left.textContent = getName( data.name );

		if ( createSUB ) {
			appendChild( right, createSUB( data ) );
		}

		var arr = data.collection;
		var i = 0, l = arr.length;

		if ( l > 0 ) {

			for ( ; i<l; ++i ) {
				appendChild( bottom, createLI( arr[ i ] ) );
			}

		} else {

			querySelector( result, '.section' ).classList.add( 'empty' );

		}

		return result;

	};

	var weightTemplate = querySelector( document, '#weight' );

	var createWeight = ( data ) => {

		var result = cloneNode( weightTemplate );
		querySelector( result, 'span' ).textContent = getName( data.weight );

		return result;

	};

	var costTemplate = querySelector( document, '#cost' );

	var slashTemplate = querySelector( document, '#slash' );
	var boldSlashTemplate = querySelector( document, '#bold-slash' );

	var createCost = ( data ) => {

		var result, span;

		if ( Array.isArray( data ) ) {

			result = cloneNode( boldSlashTemplate );
			span = querySelector( result, 'span' );

			appendChild( span, createCost( data[ 0 ] ) );
			appendChild( span, createCost( data[ 1 ] ) );

		} else {

			result = cloneNode( costTemplate );
			span = querySelectorAll( result, '.cost span' );

			var c = data.toFixed( 2 ).split( '.' );

			span[ 0 ].textContent = c[ 0 ];
			span[ 1 ].textContent = c[ 1 ];

		}

		return result;

	};

	var mlTemplate = querySelector( document, '#ml' );

	var createML = ( data ) => {

		var result, span;

		if ( Array.isArray( data ) ) {

			result = cloneNode( slashTemplate );
			span = querySelector( result, 'span' );

			appendChild( span, createML( data[ 0 ] ) );
			appendChild( span, createML( data[ 1 ] ) );

		} else {

			result = cloneNode( mlTemplate );
			querySelector( result, 'span' ).textContent = data;

		}

		return result;

	};

	var createCapacity = ( data ) => createML( data.capacity );

	var dishTemplate = querySelector( document, '#dish' );

	var createDish = ( data ) => {

		var result = cloneNode( dishTemplate );
		var li = querySelector( result, 'li' );

		var left = querySelector( li, 'div' );
		var right = querySelector( li, 'div:last-of-type' );
		var bottom = querySelector( li, 'ul' );

		var name = querySelector( left, 'span' );

		name.textContent = getName( data.name );

		if ( data.bold ) {
			name.classList.add( 'bold' );
		}

		if ( data.weight ) {
			appendChild( left, createWeight( data ) );
		}

		if ( data.cost ) {
			appendChild( right, createCost( data.cost ) );
		}

		if ( data.collection ) {

			var arr = data.collection;
			var i = 0, l = arr.length;

			for ( ; i<l; ++i ) {
				appendChild( bottom, createDish( arr[ i ] ) );
			}

		}

		return result;

	};

	var alcTemplate = querySelector( document, '#alc' );

	var createAlc = ( data ) => {

		var result;
		var li, arr;

		if ( ( arr = data.collection ) ) {

			result = document.createDocumentFragment()

			var alc;
			var o, i = 0, l = arr.length;
			for ( ; i<l; ++i ) {

				o = arr[ i ];

				alc = cloneNode( alcTemplate );
				li = querySelector( alc, 'li' );

				querySelector( li, '.name' ).textContent = getName( data.name );
				querySelector( li, '.kind' ).textContent = getName( o.name );

				if ( o.cost ) {
					appendChild( querySelector( li, 'div:last-of-type' ), createCost( o.cost ) );
				}

				appendChild( result, alc );

			}

		} else {

			result = cloneNode( alcTemplate );
			li = querySelector( result, 'li' );

			querySelector( li, '.name' ).textContent = getName( data.name );
			// querySelector( li, '.kind' ).textContent = getName( data.name );

			if ( data.cost ) {
				appendChild( querySelector( li, 'div:last-of-type' ), createCost( data.cost ) );
			}

		}

		return result;

	};

	var beerTemplate = querySelector( document, '#beer' );

	var createBeer = ( data ) => {

		var result = cloneNode( beerTemplate );
		var li = querySelector( result, 'li' );

		querySelector( result, '.name' ).textContent = getName( data.name );

		if ( data.alc ) {
			querySelector( result, '.alc' ).textContent = data.alc;
		}

		if ( data.den ) {
			querySelector( result, '.den' ).textContent = data.den;
		}

		if ( data.cap ) {
			querySelector( result, '.cap' ).textContent = data.cap;
		}

		if ( data.cost ) {
			appendChild( querySelector( li, 'div:last-of-type' ), createCost( data.cost ) );
		}

		return result;

	};

	var cocktailTemplate = querySelector( document, '#cocktail' );

	var createCocktail = ( data ) => {

		var result = cloneNode( cocktailTemplate );
		var li = querySelector( result, 'li' );

		querySelector( result, '.name' ).textContent = getName( data.name );

		if ( data.cap ) {
			querySelector( result, '.cap' ).textContent = data.cap;
		}

		if ( data.cost ) {
			appendChild( querySelector( li, 'div:last-of-type' ), createCost( data.cost ) );
		}

		return result;

	};

	var shotTemplate = querySelector( document, '#shot' );

	var createShot = ( data ) => {

		var result = cloneNode( shotTemplate );
		var div = querySelector( result, 'div' );

		querySelector( result, '.name' ).textContent = getName( data.name );

		if ( data.cap ) {
			querySelector( result, '.cap' ).textContent = data.cap;
		}

		if ( data.cost ) {
			appendChild( querySelector( div, 'div:last-of-type' ), createCost( data.cost ) );
		}

		return result;

	};


	// Object.values( data ).forEach( ( o ) => {
	//
	// 	var val = 0;
	// 	var min = Number.POSITIVE_INFINITY;
	// 	var max = Number.NEGATIVE_INFINITY;
	//
	// 	var avg;
	// 	var cnt = 0;
	//
	// 	var check = ( o ) => {
	//
	// 		if ( o.cost ) {
	// 			var cost = Array.isArray( o.cost ) ? o.cost[ 1 ] : o.cost;
	// 			val += cost;
	// 			if ( cost < min ) min = cost;
	// 			if ( cost > max ) max = cost;
	// 			cnt++;
	// 		}
	//
	// 		if ( o.collection ) Object.values( o.collection ).forEach( check );
	//
	// 	};
	//
	// 	var calc = ( o ) => {
	//
	// 		if ( o.cost ) {
	//
	// 			var cost = Array.isArray( o.cost ) ? o.cost[ 1 ] : o.cost;
	// 			var ratio;
	//
	// 			if ( cost > avg ) {
	// 				ratio = 7.5 - ( ( ( cost - avg ) / ( max - avg ) * 2.5 ) || 0 );
	// 			} else {
	// 				ratio = 7.5 + ( ( ( cost - min ) / ( avg - min ) * 2.5 ) || 0 );
	// 			}
	// 			ratio = 10 + ratio / 10;
	//
	// 			if ( Array.isArray( o.cost ) ) {
	// 				o.cost = o.cost.map( ( c ) => Math.round( c * ratio ) / 10 );
	// 			} else {
	// 				o.cost = Math.round( o.cost * ratio ) / 10;
	// 			}
	// 		}
	//
	// 		if ( o.collection ) Object.values( o.collection ).forEach( calc );
	//
	// 	};
	//
	// 	check( o );
	//
	// 	avg = val / cnt;
	//
	// 	calc( o );
	//
	// } );

	var colon = querySelectorAll( document, '.page>div' );

	appendChild( colon[ 0 ], createSection( data.BeerStarters, createDish ) );
	appendChild( colon[ 0 ], createSection( data.Starters, createDish ) );
	appendChild( colon[ 0 ], createSection( data.StartersForCompany, createDish ) );
	appendChild( colon[ 0 ], createSection( data.Additives, createDish ) );

	appendChild( colon[ 1 ], createSection( data.Soups, createDish ) );
	appendChild( colon[ 1 ], createSection( data.Salads, createDish ) );
	appendChild( colon[ 1 ], createSection( data.SeasonalSalads, createDish ) );
	appendChild( colon[ 1 ], createSection( data.BurgersSandwiches, createDish ) );
	// colon[ 1 ].insertAdjacentHTML( 'beforeend', '<div class="img"><img src="cb.svg" /></div>' );

	appendChild( colon[ 2 ], createSection( data.HotDishes, createDish ) );
	appendChild( colon[ 2 ], createSection( data.Garnish, createDish ) );
	appendChild( colon[ 2 ], createSection( data.Desserts, createDish ) );
	// colon[ 2 ].insertAdjacentHTML( 'beforeend', '<div class="img"><img src="bc.svg" style="height:31.417mm" /></div>' );
	colon[ 2 ].insertAdjacentHTML( 'beforeend', '<div class="img"><img src="cb.svg" /></div>' );

	appendChild( colon[ 3 ], createSection( data.Gasing, createDish ) );
	appendChild( colon[ 3 ], createSection( data.Coffee, createDish ) );
	appendChild( colon[ 3 ], createSection( data.Tea, createDish, createWeight ) );
	appendChild( colon[ 3 ], createSection( data.Juice, createDish, createWeight ) );
	appendChild( colon[ 3 ], createSection( data.Cocktails, createDish ) );

	appendChild( colon[ 4 ], createSection( data.WhiteWine, createDish, createCapacity ) );
	appendChild( colon[ 4 ], createSection( data.RoseWine, createDish, createCapacity ) );
	appendChild( colon[ 4 ], createSection( data.RedWine, createDish, createCapacity ) );
	appendChild( colon[ 4 ], createSection( data.SparklingWine, createDish, createCapacity ) );
	appendChild( colon[ 4 ], createSection( data.PortWine, createDish, createCapacity ) );
	appendChild( colon[ 4 ], createSection( data.Martini, createDish, createCapacity ) );

	appendChild( colon[ 5 ], createSection( data.Tinctures, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Whiskey, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Brandy, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Rom, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Bitter, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Tequila, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Gin, createAlc, createCapacity ) );
	appendChild( colon[ 5 ], createSection( data.Vodka, createAlc, createCapacity ) );

	// appendChild( colon[ 5 ], createSection( data.Cocktails, createCocktail ) );
	// appendChild( colon[ 5 ], createShot( data.Shot ) );

	colon[ 6 ].insertAdjacentHTML( 'beforeend', `
		<div style="margin-top: 6cm">
			<img src="/@/logo.svg" style="width:45mm; filter: invert( 1 )" />
		</div>
		<div class="bold" style="font-size: 72pt">${ getName( [ "Меню", "Menu" ] ) }</div>
	` );

	colon[ 6 ].insertAdjacentHTML( 'beforeend', `
		<div class="opacity" style="font-size: 24pt; line-height: 24pt; margin-top: 5cm">
			${ getName( [ 'Закажите', 'Order' ] ) }<br />${ getName( [ 'доставку!', 'Delivery!' ] ) }
		</div>
		<div class="opacity" style="margin: 8mm 0 5mm 0">
			<img src="qr.svg" />
		</div>
		<div class="opacity" style="font-size: 24pt; line-height: 24pt">
			irish-pub.by
		</div>
		<div class="opacity" style="font-size: 18pt; line-height: 18pt; margin-top: 1cm">
			${ getName( [ 'Специальное меню', 'Special lunch menu' ] ) }<br />
			${ getName( [ 'обедов по будням', 'on weekdays and' ] ) }<br />
			${ getName( [ 'и бранчей по выходным', 'brunch on weekends' ] ) }<br />
			${ getName( [ 'с 12:00 до 16:00', 'from 12:00 to 16:00' ] ) }
		</div>
	` );

	appendChild( colon[ 7 ], createSection( data.DraftBeer, createBeer ) );
	appendChild( colon[ 7 ], createSection( data.BottledBeer, createBeer ) );
	appendChild( colon[ 7 ], createSection( data.NonAlcoholicBeer, createBeer ) );

} ) )( this )</script>

</body>

</html>